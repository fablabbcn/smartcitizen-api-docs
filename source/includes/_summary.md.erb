<%
  # This code was moved here from layout.erb, because this file is loaded first
  # The `url` method needs to be defined before it is used.
  BASE_URL = 'https://api.smartcitizen.me/v0'
  def url path = nil, method = 'GET'
    "`#{method} #{[BASE_URL, path].compact.join('/')}`"
  end
%>

# Summary

The Smart Citizen API is a publicly available interface allowing anyone to develop applications on top of the Smart Citizen platform. For more general and hardware information check the [documentation](http://docs.smartcitizen.me/).

```shell
# Shell example
# In the shell examples we use either `curl` or the `http`
```

```javascript
// Javascript example
```

```json
# The json responses will look something like this:
[
  {
    "example_response":"example_value"
  }
]
```

## Schema

In a general sense, any [user](#users) can own as many [device](#devices) as needed. Each device represents a "real" device, containing [sensors](#sensors), which perform [measurements](#measurements). A device in a real world can be registered multiple times in the API, but it will only store data in one [device](#devices). In addition, [user](#users) can create [experiments](#experiments), which are collection of [devices](#devices) with a certain purpose. This feature is currently experimental!

![SmartCitizen UML](UML-Platform.jpg)

All API access is over HTTPS and accessed via `api.smartcitizen.me`. Some overall characteristics to bear in mind:

- Blank fields are included as `null` instead of being omitted.
- Obviously, some items are filtered by the API if your response are not authorized. See [authhentication](#authentication).
- All timestamps are returned in ISO 8601 format, non-localised: `YYYY-MM-DDTHH:MM:SSZ`.

<aside class="success">This is a simplified representation of the API. For more information, check each endpoint documentation.</aside>

## Root Endpoint

You can issue a `GET` request to the root endpoint to get all the endpoint categories that the API supports. From all the possible endpoints, you will mostly care about [devices](#devices), [measurements](#measurements), [sensors](#sensors) and [users](#users).

`$ curl https://api.smartcitizen.me`

```shell
http GET https://api.smartcitizen.me/v0/
```

```javascript
// Run this in your browser console
fetch('https://api.smartcitizen.me/v0/')
  .then(function(response) {
    return response.json();
  })
  .then(function(myJson) {
    console.log(JSON.stringify(myJson));
  });
```

```json
HTTP/1.1 200 OK
{
    "notice":"Welcome. The old API has been removed.",
    "api_documentation_url":"https://developer.smartcitizen.me",
    "current_user_url":"https://api.smartcitizen.me/v0/me",
    "devices_url":"https://api.smartcitizen.me/v0/devices",
    "measurements_url":"https://api.smartcitizen.me/v0/measurements",
    "sensors_url":"https://api.smartcitizen.me/v0/sensors",
    "users_url":"https://api.smartcitizen.me/v0/users",
    "tags_url":"https://api.smartcitizen.me/v0/tags",
    "tags_sensors_url":"https://api.smartcitizen.me/v0/tag_sensors",
    "version_git":"1.1.5\n"
}
```

## Versioning

By default and, _for now_, all requests receive the v0 version of the API. We encourage you to explicitly request this version via the URL or the HTTP Accept header.

 | endpoint
---- | ------------------------------------
**BAD** | https://api.smartcitizen.me/users
**GOOD** | https://api.smartcitizen.me/v0/users

`Accept: application/vnd.smartcitizen; version=0,application/json`
