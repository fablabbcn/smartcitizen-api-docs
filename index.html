<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <meta content="IE=edge,chrome=1" http-equiv="X-UA-Compatible">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <title>SmartCitizen API Reference</title>

    <link href="stylesheets/screen.css" rel="stylesheet" type="text/css" media="screen" />
    <link href="stylesheets/print.css" rel="stylesheet" type="text/css" media="print" />
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.0/jquery.min.js"></script>
      <script src="javascripts/all.js" type="text/javascript"></script>

  </head>

  <body class="index">
    <a href="#" id="nav-button">
      <span>
        NAV
        <img src="images/navbar.png" />
      </span>
    </a>
    <div class="tocify-wrapper">
      <img src="https://i.imgur.com/eHDzAuG.png" />
        <div class="search">
          <input type="text" class="search" id="input-search" placeholder="Search">
        </div>
        <ul class="search-results"></ul>
      <div id="toc">
      </div>
    </div>
    <div class="page-wrapper">
      <div class="dark-box"></div>
      <div class="content">
        <h1 id="summary">Summary</h1>

<blockquote>
<h3 id="definition">Definition</h3>

<p>https://new-api.smartcitizen.me</p>

<h3 id="summary-of-resources">Summary of Resources</h3>
</blockquote>
<pre><code class="highlight plaintext">/v0/me
/v0/users/:id
/v0/devices/:id
/v0/kits/:id
/v0/sensors/:id
</code></pre>

<p>The Smartcitizen V0 API is a publicly available interface allowing developers access to the smartcitizen dataset. The interface is stable and currently used by the Strava mobile applications. However, changes are occasionally made to improve performance and enhance features. See the changelog for more details.</p>

<h2 id="versioning">Versioning</h2>

<p>By default, all requests receive the v0 version of the API. We encourage you to explicitly request this version via the URL or the HTTP Accept header.</p>

<table><thead>
<tr>
<th></th>
<th>endpoint</th>
</tr>
</thead><tbody>
<tr>
<td><strong>BAD</strong></td>
<td>https://new-api.smartcitizen.me/users</td>
</tr>
<tr>
<td><strong>GOOD</strong></td>
<td>https://new-api.smartcitizen.me/v0/users</td>
</tr>
</tbody></table>

<p><code class="prettyprint">Accept: application/vnd.smartcitizen; version=0,application/json</code></p>

<h2 id="schema">Schema</h2>

<p>All API access is over HTTPS (with the exception of <code class="prettyprint">/add</code>) and accessed via <code class="prettyprint">new-api.smartcitizen.me</code>.</p>

<aside class="notice">This will eventually change to https://api.smartcitizen.me</aside>

<p>Blank fields are included as <code class="prettyprint">null</code> instead of being omitted.</p>

<p>All timestamps are returned in ISO 8601 format:</p>

<p><code class="prettyprint">YYYY-MM-DDTHH:MM:SSZ</code></p>

<h2 id="root-endpoint">Root Endpoint</h2>

<p>You can issue a GET request to the root endpoint to get all the endpoint categories that the API supports:</p>

<p><code class="prettyprint">$ curl https://new-api.smartcitizen.me</code></p>

<h2 id="json-p-callbacks">JSON-P Callbacks</h2>

<p>You can send a <code class="prettyprint">?callback</code> parameter to any GET call to have the results wrapped in a JSON function.</p>

<h2 id="postman">Postman</h2>

<p>We recommend that you try our API using <a href="https://www.getpostman.com/">Postman</a>, we have created a shared collection that you can import from here <a href="https://www.getpostman.com/collections/85a92402907e3cb07759">https://www.getpostman.com/collections/85a92402907e3cb07759</a></p>

<h1 id="authentication">Authentication</h1>

<p>There are 3 ways you can access the API. OAuth 2.0 is the recommended method.</p>

<h2 id="oauth-2.0">OAuth 2.0</h2>
<pre><code class="highlight shell"><span class="c"># OAuth2 Token (sent as a parameter)</span>
<span class="gp">$ </span>curl -G https://new-api.smartcitizen.me/v0/me?access_token<span class="o">=</span>OAUTH-TOKEN

<span class="c"># OAuth2 Token (sent in a header)</span>
<span class="gp">$ </span>curl -H <span class="s2">"Authorization: token OAUTH-TOKEN"</span> https://new-api.smartcitizen.me/v0/me
</code></pre>

<aside class="success">This is the recommended and safest way to access the API.</aside>

<p>A basic example resides here <a href="https://example.smartcitizen.me">https://example.smartcitizen.me</a> and its source code is here <a href="https://github.com/johnrees/smartcitizen-oauth-example">https://github.com/johnrees/smartcitizen-oauth-example</a>.</p>

<p><a href="https://id.smartcitizen.me">https://id.smartcitizen.me</a> currently uses <a href="https://github.com/doorkeeper-gem/doorkeeper">Doorkeeper gem</a> for managing the OAuth component but that is subject to change.</p>

<p>Applications can be added here <a href="https://id.smartcitizen.me/oauth/applications">https://id.smartcitizen.me/oauth/applications</a>. Whilst in development this is completely open for public access but this will change.</p>

<p>POSTman settings are as follows -</p>

<p><img alt="Postman settings" src="https://i.imgur.com/TzIkLSQ.png" /></p>

<p>The correct <code class="prettyprint">Client ID</code> and <code class="prettyprint">Client Secret</code> can be found at <a href="https://id.smartcitizen.me/oauth/applications">https://id.smartcitizen.me/oauth/applications</a>.</p>

<h2 id="http-basic-auth">HTTP Basic Auth</h2>
<pre><code class="highlight shell"><span class="c"># Add a base64 encoded hash of 'username:password' in the header</span>
curl <span class="s1">'https://new-api.smartcitizen.me/v0/me'</span> -H <span class="s1">'Authorization: Basic am9objpzbWFydHBhc3M='</span>

<span class="c"># NOT RECOMMENDED - add username and password in the header</span>
curl <span class="s1">'https://new-api.smartcitizen.me/v0/me'</span> --user username:password
</code></pre>

<p>This method enables you to authenticate your requests with your username and password. Despite using SSL we do not recommend this method as it can be very easy to accidentally share your secret credentials.</p>

<h2 id="http-token-authentication">HTTP Token Authentication</h2>
<pre><code class="highlight shell"><span class="gp">$ </span>curl <span class="s1">'https://new-api.smartcitizen.me/v0/me'</span> -IH <span class="s2">"Authorization: Token token=b32a8e54b11c4de5a4a351734c80a14a"</span>
</code></pre>

<aside class="warning">This method will be deprecated soon, we are keeping it during the transition from the legacy API.</aside>

<p>You should not use this approach for new applications.</p>

<h1 id="filtering-responses">Filtering Responses</h1>

<h2 id="pagination">Pagination</h2>
<pre><code class="highlight shell"><span class="gp">$ </span>curl --include <span class="s1">'https://new-api.smartcitizen.me/v0/users?page=5'</span>
HTTP/1.1 200 OK
Link: &lt;https://new-api.smartcitizen.me/v0/users?page<span class="o">=</span>1&gt;; <span class="nv">rel</span><span class="o">=</span><span class="s2">"first"</span>,
  &lt;https://new-api.smartcitizen.me/v0/users?page<span class="o">=</span>173&gt;; <span class="nv">rel</span><span class="o">=</span><span class="s2">"last"</span>,
  &lt;https://new-api.smartcitizen.me/v0/users?page<span class="o">=</span>6&gt;; <span class="nv">rel</span><span class="o">=</span><span class="s2">"next"</span>,
  &lt;https://new-api.smartcitizen.me/v0/users?page<span class="o">=</span>4&gt;; <span class="nv">rel</span><span class="o">=</span><span class="s2">"prev"</span>
Total: 4321
Per-Page: 25
</code></pre>

<p>Most endpoints that return more than a single result e.g. <code class="prettyprint">/v0/users</code>, <code class="prettyprint">v0/devices</code> will return blocks of the result set that can be manipulated using the following parameters.</p>

<table><thead>
<tr>
<th>Parameter</th>
<th>Default</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td><strong>page</strong><br/><em>integer</em></td>
<td>1</td>
<td>page</td>
</tr>
<tr>
<td><strong>per_page</strong><br/><em>integer</em></td>
<td>25</td>
<td>page</td>
</tr>
</tbody></table>

<p>The headers will include links to the <code class="prettyprint">Total</code> results count, number of results shown <code class="prettyprint">Per-Page</code> and <code class="prettyprint">first</code>, <code class="prettyprint">last</code>, <code class="prettyprint">next</code> and <code class="prettyprint">previous</code> results.</p>

<h2 id="global-search">Global Search</h2>

<blockquote>
<h3 id="definition">Definition</h3>

<p>GET https://new-api.smartcitizen.me/v0/search</p>
</blockquote>
<pre><code class="highlight shell">curl <span class="s2">"https://new-api.smartcitizen.me/v0/search?q=anastasia"</span>
</code></pre>

<blockquote>
<p>The above command returns JSON structured like this:</p>
</blockquote>
<pre><code class="highlight json"><span class="p">[</span><span class="w">
  </span><span class="p">{</span><span class="w">
    </span><span class="s2">"id"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mi">32</span><span class="p">,</span><span class="w">
    </span><span class="s2">"type"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"User"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"username"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"anastasia"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"avatar"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span><span class="w">
    </span><span class="s2">"city"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span><span class="w">
    </span><span class="s2">"country_code"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="w">
  </span><span class="p">},</span><span class="w">
  </span><span class="p">{</span><span class="w">
    </span><span class="s2">"id"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mi">56</span><span class="p">,</span><span class="w">
    </span><span class="s2">"type"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"Device"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"name"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"nat kit"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"description"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"nat kit at home"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"owner_id"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mi">32</span><span class="p">,</span><span class="w">
    </span><span class="s2">"owner_username"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"anastasia"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"city"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"Barcelona"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"country_code"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"ES"</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">]</span><span class="w">
</span></code></pre>

<aside class='warning'>THE RESPONSE FOR THIS ENDPOINT WILL PROBABLY CHANGE. But you can use it now and we will add ?version=1, ?version=2&hellip; to the URL so it is reliable.</aside>

<p>To search both Users and Devices at the same time you can use the global search endpoint.</p>

<h3 id="required-parameters">Required Parameters</h3>

<table><thead>
<tr>
<th>Parameter</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td><strong>q</strong><br/><em>string</em></td>
<td>Query string</td>
</tr>
</tbody></table>

<h3 id="response">Response</h3>

<p>There can be two types of object included in the response array, <a href="#devices">Devices</a> and <a href="#users">Users</a>.</p>

<h4 id="device-object">Device Object</h4>

<table><thead>
<tr>
<th>Parameter</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td><strong>id</strong><br/><em>integer</em></td>
<td>Unique ID for the device</td>
</tr>
<tr>
<td><strong>name</strong><br/><em>string</em></td>
<td>Name of the device</td>
</tr>
<tr>
<td><strong>owner_id</strong><br/><em>integer</em></td>
<td>Unique ID of the device&rsquo;s owner</td>
</tr>
<tr>
<td><strong>owner_username</strong><br/><em>string</em></td>
<td>Unique username of the device&rsquo;s owner</td>
</tr>
<tr>
<td><strong>city</strong><br/><em>string</em></td>
<td>City the device is in</td>
</tr>
<tr>
<td><strong>country_code</strong><br/><em>string</em></td>
<td>Alpha-2 country code of the device</td>
</tr>
</tbody></table>

<h4 id="user-object">User Object</h4>

<table><thead>
<tr>
<th>Parameter</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td><strong>id</strong><br/><em>integer</em></td>
<td>Unique ID for the user</td>
</tr>
<tr>
<td><strong>username</strong><br/><em>string</em></td>
<td>Unique username of the user</td>
</tr>
<tr>
<td><strong>avatar</strong><br/><em>string</em></td>
<td>URL of the user&rsquo;s avatar</td>
</tr>
<tr>
<td><strong>city</strong><br/><em>string</em></td>
<td>City the user is in</td>
</tr>
<tr>
<td><strong>country_code</strong><br/><em>string</em></td>
<td>Alpha-2 country code of the user</td>
</tr>
</tbody></table>

<h2 id="basic-searching">Basic Searching</h2>

<p>Similar to the <a href="#pagination">pagination</a>, you can filter and sort most responses that return more than one result. This is done with the <a href="https://github.com/activerecord-hackery/ransack">ransack</a> library.</p>

<p><a href="https://github.com/activerecord-hackery/ransack/wiki/Basic-Searching">https://github.com/activerecord-hackery/ransack/wiki/Basic-Searching</a></p>

<table><thead>
<tr>
<th>Query</th>
<th>Type</th>
<th>Value</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>/users?q[<strong>first_name_eq</strong>]=adam</td>
<td>string</td>
<td>adam</td>
<td>Users where first name equals &lsquo;Adam&rsquo;</td>
</tr>
<tr>
<td>/devices?q[<strong>owner_id_eq</strong>]=1</td>
<td>integer</td>
<td>1</td>
<td>Devices where owner ID equals 1</td>
</tr>
<tr>
<td>/sensors?q[<strong>id_lt</strong>]=100</td>
<td>integer</td>
<td>100</td>
<td>Sensors where ID less than 100</td>
</tr>
<tr>
<td>/users?q[<strong>username_cont</strong>]=sck</td>
<td>string</td>
<td>sck</td>
<td>Users where username contains &#39;sck&rsquo;</td>
</tr>
</tbody></table>

<h2 id="sorting-results">Sorting Results</h2>

<p>You can order results with the <code class="prettyprint">q[sort]</code> parameter</p>

<table><thead>
<tr>
<th>Parameter</th>
<th>Value</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td><strong>/users?q[sort]=username%20asc</strong><br/><em>string</em></td>
<td>username asc</td>
<td>Users ordered by username in ASCENDING order</td>
</tr>
<tr>
<td><strong>/devices?q[sort]=id%20desc</strong><br/><em>integer</em></td>
<td>id desc</td>
<td>Devices ordered by id in DESCENDING order</td>
</tr>
</tbody></table>

<h2 id="pretty-printing">Pretty Printing</h2>
<pre><code class="highlight shell"><span class="c"># Default Minimal Response</span>
curl <span class="s2">"https://new-api.smartcitizen.me/v0/sensors/10"</span>

<span class="o">{</span><span class="s2">"id"</span>:10,<span class="s2">"name"</span>:<span class="s2">"Battery"</span>,<span class="s2">"description"</span>:<span class="s2">"Custom Circuit"</span>,<span class="s2">"unit"</span>:<span class="s2">"%"</span>,<span class="s2">"created_at"</span>:<span class="s2">"2015-02-02T18:18:00.276Z"</span>,<span class="s2">"updated_at"</span>:<span class="s2">"2015-02-02T18:18:00.276Z"</span><span class="o">}</span>

<span class="c"># Pretty Response</span>
curl <span class="s2">"https://new-api.smartcitizen.me/v0/sensors/10?pretty=true"</span>

<span class="o">{</span>
  <span class="s2">"id"</span> : 10,
  <span class="s2">"name"</span> : <span class="s2">"Battery"</span>,
  <span class="s2">"description"</span> : <span class="s2">"Custom Circuit"</span>,
  <span class="s2">"unit"</span> : <span class="s2">"%"</span>,
  <span class="s2">"created_at"</span> : <span class="s2">"2015-02-02T18:18:00.276Z"</span>,
  <span class="s2">"updated_at"</span> : <span class="s2">"2015-02-02T18:18:00.276Z"</span>
<span class="o">}</span>
</code></pre>

<p>You can format responses so that they are easier to read by adding <code class="prettyprint">pretty=true</code> to a request.</p>

<h1 id="devices">Devices</h1>

<h2 id="world-map-of-devices">World Map of Devices</h2>

<blockquote>
<h3 id="definition">Definition</h3>

<p>GET https://new-api.smartcitizen.me/v0/devices/world_map</p>
</blockquote>
<pre><code class="highlight shell"><span class="gp">$ </span>curl -G https://new-api.smartcitizen.me/v0/devices/world_map

HTTP/1.1 200 OK
<span class="o">{</span>
  <span class="s2">"added_at"</span>: <span class="s2">"2015-02-02T15:59:48.435Z"</span>,
  <span class="s2">"city"</span>: <span class="s2">"Haarlem"</span>,
  <span class="s2">"country_code"</span>: <span class="s2">"NL"</span>,
  <span class="s2">"data"</span>: <span class="o">{</span>
    <span class="s2">"12"</span>: 14.38578857421875,
    <span class="s2">"12_raw"</span>: 25132,
    <span class="s2">"13"</span>: 64.3577880859375,
    <span class="s2">"13_raw"</span>: 30072,
    <span class="s2">"14"</span>: 0.0,
    <span class="s2">"14_raw"</span>: 0,
    <span class="s2">"15"</span>: 133.482,
    <span class="s2">"15_raw"</span>: 133482,
    <span class="s2">"16"</span>: 41.951,
    <span class="s2">"16_raw"</span>: 41951,
    <span class="s2">"17"</span>: 80.0,
    <span class="s2">"17_raw"</span>: 800,
    <span class="s2">"18"</span>: 0,
    <span class="s2">"21"</span>: 13,
    <span class="s2">"7"</span>: 50.0,
    <span class="s2">"7_raw"</span>: 0,
    <span class="s2">"added_at"</span>: <span class="s2">"2015-04-28T14:16:08.238Z"</span>,
    <span class="s2">"calibrated_at"</span>: <span class="s2">"2015-04-28T14:16:08.238Z"</span>,
    <span class="s2">"recorded_at"</span>: <span class="s2">"2015-04-28T14:16:08.238Z"</span>
  <span class="o">}</span>,
  <span class="s2">"description"</span>: <span class="s2">""</span>,
  <span class="s2">"exposure"</span>: <span class="s2">"indoor"</span>,
  <span class="s2">"id"</span>: 625,
  <span class="s2">"kit_id"</span>: 3,
  <span class="s2">"latitude"</span>: 52.3781227,
  <span class="s2">"longitude"</span>: 4.6291324,
  <span class="s2">"name"</span>: <span class="s2">"SmartHaarlem"</span>,
  <span class="s2">"owner_id"</span>: 667,
  <span class="s2">"owner_username"</span>: <span class="s2">"SmartHaarlem"</span>,
  <span class="s2">"status"</span>: <span class="s2">"offline"</span>
<span class="o">}</span>
...
<span class="sb">``</span>

Returns an array with of summarized device objects <span class="k">for </span>displaying on the world map.

&lt;aside <span class="nv">class</span><span class="o">=</span><span class="s1">'warning'</span>&gt;Note: This does not load super-fast right now, but it will load instantly <span class="k">in </span>the next couple of days&lt;/aside&gt;

&lt;aside <span class="nv">class</span><span class="o">=</span><span class="s1">'notice'</span>&gt;This endpoint will be cached, therefore you will not be able to use parameters to paginate, search or sort the results. We recommend that you filter the json on the client-side.&lt;/aside&gt;

Parameter | Example | Description
--------- | ------- | -----------
<span class="k">**</span>id<span class="k">**</span>&lt;br/&gt;<span class="k">*</span>integer<span class="k">*</span> | 1619 | Unique ID of the device
<span class="k">**</span>name<span class="k">**</span>&lt;br/&gt;<span class="k">*</span>string<span class="k">*</span> | Long Lane, SE1 <span class="o">(</span>new<span class="o">)</span> | Name of the device
<span class="k">**</span>description<span class="k">**</span>&lt;br/&gt;<span class="k">*</span>string<span class="k">*</span> | An SCK <span class="k">in </span>Southwark | Description of the device
<span class="k">**</span>owner_id<span class="k">**</span>&lt;br/&gt;<span class="k">*</span>integer<span class="k">*</span> | 848 | Unique ID of the device<span class="s1">'s owner
**owner_username**&lt;br/&gt;*string* | dankarran | Unique username of the device'</span>s owner
<span class="k">**</span>latitude<span class="k">**</span>&lt;br/&gt;<span class="k">*</span>decimal<span class="k">*</span> | 51.4996843 | Latitude of the device
<span class="k">**</span>longitude<span class="k">**</span>&lt;br/&gt;<span class="k">*</span>decimal<span class="k">*</span> | -0.086883400000033 | Longitude of the device
<span class="k">**</span>city<span class="k">**</span>&lt;br/&gt;<span class="k">*</span>string<span class="k">*</span> | Southwark | City of the device
<span class="k">**</span>country_code<span class="k">**</span>&lt;br/&gt;<span class="k">*</span>string<span class="k">*</span> | GB | Alpha-2 Country Code of the device
<span class="k">**</span>kit_id<span class="k">**</span>&lt;br/&gt;<span class="k">*</span>integer<span class="k">*</span> | 3 | Kit that the device belongs to
<span class="k">**</span>status<span class="k">**</span>&lt;br/&gt;<span class="k">*</span>string<span class="k">*</span> | offline | Can be offline, online or new
<span class="k">**</span>exposure<span class="k">**</span>&lt;br/&gt;<span class="k">*</span>string<span class="k">*</span> | indoor | Can be indoor or outdoor
<span class="k">**</span>data<span class="k">**</span>&lt;br/&gt;<span class="k">*</span>object<span class="k">*</span> | <span class="o">{</span>&lt;br/&gt; 7: 50.0,&lt;br/&gt;7_raw: 0,&lt;br/&gt;recorded_at: <span class="s2">"2015-04-30T17:56:04.432Z"</span>,&lt;br/&gt;calibrated_at: <span class="s2">"2015-04-30T17:56:04.432Z"</span>,&lt;br/&gt;added_at: <span class="s2">"2015-04-30T17:56:04.432Z"</span> &lt;br/&gt;<span class="o">}</span> | The latest readings stored <span class="k">for </span>the device. Numerical keys are sensor ids. &lt;br/&gt;&lt;br/&gt;So 7 is the calibrated reading of <span class="sb">`</span>/v0/sensors/7<span class="sb">`</span>&lt;br/&gt;&lt;br/&gt;<span class="sb">`</span>7_raw<span class="sb">`</span> is what was posted to the platform.
<span class="k">**</span>added_at<span class="k">**</span>&lt;br/&gt;<span class="k">*</span>datetime<span class="k">*</span> | <span class="s2">"2015-04-30T17:56:04.432Z"</span> | When the device was added to the platform

<span class="c">## Add a Device</span>

<span class="gp">&gt; </span><span class="c">### Definition</span>
POST https://new-api.smartcitizen.me/v0/devices

You must be authenticated to add a device. The currently authenticated user will be registered as the <span class="sb">`</span>owner<span class="sb">`</span> of the new device.

Parameter | Required? | Description
--------- | ------- | -----------
<span class="k">**</span>name<span class="k">**</span>&lt;br/&gt;<span class="k">*</span>string<span class="k">*</span> | ✓ | Name of the device
<span class="k">**</span>description<span class="k">**</span>&lt;br/&gt;<span class="k">*</span>string<span class="k">*</span> | | Description of the device
<span class="k">**</span>mac_address<span class="k">**</span>&lt;br/&gt;<span class="k">*</span>string<span class="k">*</span> | ✓ | MAC Address of the device
<span class="k">**</span>kit_id<span class="k">**</span>&lt;br/&gt;<span class="k">*</span>integer<span class="k">*</span> | | Unique ID of the <span class="o">[</span>kit]<span class="o">(</span><span class="c">#kits) for the device</span>
<span class="k">**</span>exposure<span class="k">**</span>&lt;br/&gt;<span class="k">*</span>string<span class="k">*</span> | | Either <span class="sb">`</span>indoor<span class="sb">`</span> or <span class="sb">`</span>outdoor<span class="sb">`</span>
<span class="k">**</span>latitude<span class="k">**</span>&lt;br/&gt;<span class="k">*</span>decimal<span class="k">*</span> | | Latitude of the device
<span class="k">**</span>longitude<span class="k">**</span>&lt;br/&gt;<span class="k">*</span>decimal<span class="k">*</span> | | Longitude of the device

<span class="c">## Update a Device</span>

<span class="gp">&gt; </span><span class="c">### Definition</span>
PATCH https://new-api.smartcitizen.me/v0/devices/:id

You must be authenticated and registered as the device<span class="s1">'s `owner` if you wish to update a device.

Parameter | Example | Description
--------- | ------- | -----------
**id**&lt;br/&gt;*integer* | 2 | Unique ID of the device
**name**&lt;br/&gt;*string* | Beach SCK | Name of the device
**description**&lt;br/&gt;*string* | A Smart Citizen on the Beach | Description of the device
**mac_address**&lt;br/&gt;*string* | 00:1C:B3:09:85:15 | MAC Address of the device
**kit_id**&lt;br/&gt;*integer* | 3 | Unique ID of the [kit](#kits) for the device
**exposure**&lt;br/&gt;*string* | | Either `indoor` or `outdoor`
**latitude**&lt;br/&gt;*decimal* | 41.401108 | Latitude of the device
**longitude**&lt;br/&gt;*decimal* | 2.215319 | Longitude of the device

## Get a Device

&gt; ### Definition
GET https://new-api.smartcitizen.me/v0/devices/:id

</span></code></pre>

<p>$ curl -G https://new-api.smartcitizen.me/v0/devices/3
&ldquo;`</p>

<p>Returns a single device. Example of a complete response - <a href="http://new-api.smartcitizen.me/devices/1616">http://new-api.smartcitizen.me/v0/devices/1616</a></p>

<table><thead>
<tr>
<th>Parameter</th>
<th>Example</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td><strong>id</strong><br/><em>integer</em></td>
<td>2</td>
<td>Unique ID of the device</td>
</tr>
<tr>
<td><strong>owner</strong><br/><em>object</em></td>
<td><a href="#get-a-user">user</a></td>
<td>The user that owns the device</td>
</tr>
<tr>
<td><strong>name</strong><br/><em>string</em></td>
<td>Beach SCK</td>
<td>Name of the device</td>
</tr>
<tr>
<td><strong>description</strong><br/><em>string</em></td>
<td>A Smart Citizen on the Beach</td>
<td>Description of the device</td>
</tr>
<tr>
<td><strong>status</strong><br/><em>string</em></td>
<td>new</td>
<td><code class="prettyprint">new</code> if never updated,<br/><code class="prettyprint">online</code> if updated less than 10 minutes ago,<br/> <code class="prettyprint">offline</code> if updated more than 10 minutes ago</td>
</tr>
<tr>
<td><strong>added_at</strong><br/><em>datetime</em></td>
<td>2015-02-02T15:59:48.109Z</td>
<td>When the device was added to the platform</td>
</tr>
<tr>
<td><strong>last_reading_at</strong><br/><em>datetime</em></td>
<td>2015-02-02T15:59:48.109Z</td>
<td>When the device last posted a reading to the platform</td>
</tr>
<tr>
<td><strong>updated_at</strong><br/><em>datetime</em></td>
<td>2015-02-02T15:59:48.109Z</td>
<td>When the device was last updated</td>
</tr>
<tr>
<td><strong>data</strong><br/><em>object</em></td>
<td><a href="#data-object">data-object</a></td>
<td>The latest data for the device <em>(see table below)</em></td>
</tr>
<tr>
<td><strong>kit</strong><br/><em>object</em></td>
<td><a href="#kits">kit</a></td>
<td>Information about the kit that the device is</td>
</tr>
<tr>
<td><strong>mac_address</strong><br/><em>string</em></td>
<td>00:1C:B3:09:85:15</td>
<td>Shown if current_user is authenticated and is owner of the device. MAC Address of the device</td>
</tr>
</tbody></table>

<h4 id="data-object">Data Object</h4>

<table><thead>
<tr>
<th>Parameter</th>
<th>Example</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td><strong>recorded_at</strong><br/><em>datetime</em></td>
<td>2015-02-11T10:03:36.653Z</td>
<td>When the device&rsquo;s data was recorded</td>
</tr>
<tr>
<td><strong>added_at</strong><br/><em>datetime</em></td>
<td>2015-02-11T10:03:36.653Z</td>
<td>When the device&rsquo;s data was posted to the platform</td>
</tr>
<tr>
<td><strong>calibrated_at</strong><br/><em>datetime</em></td>
<td>2015-02-11T10:03:36.653Z</td>
<td>When the device&rsquo;s data was calibrated by the platform</td>
</tr>
<tr>
<td><strong>firmware</strong><br/><em>string</em></td>
<td><em>[IGNORE]</em></td>
<td>Ignore for now</td>
</tr>
<tr>
<td><strong>location.ip</strong><br/><em>string</em></td>
<td></td>
<td>Ignore for now</td>
</tr>
<tr>
<td><strong>location.exposure</strong><br/><em>string</em></td>
<td><code class="prettyprint">indoor</code> or <code class="prettyprint">outdoor</code></td>
<td>Where the device is located</td>
</tr>
<tr>
<td><strong>location.elevation</strong><br/><em>integer</em></td>
<td>500</td>
<td>Measured in metres</td>
</tr>
<tr>
<td><strong>location.latitude</strong><br/><em>decimal</em></td>
<td>39.1529768625514</td>
<td>Latitude</td>
</tr>
<tr>
<td><strong>location.longitude</strong><br/><em>decimal</em></td>
<td>-77.2663983320978</td>
<td>Longitude</td>
</tr>
<tr>
<td><strong>location.geohash</strong><br/><em>string</em></td>
<td>dqcn9z86d7</td>
<td><a href="http://www.bigfastblog.com/geohash-intro">Geohash explanation</a></td>
</tr>
<tr>
<td><strong>location.city</strong><br/><em>string</em></td>
<td>Germantown</td>
<td>City where the device is</td>
</tr>
<tr>
<td><strong>location.country_code</strong><br/><em>string</em></td>
<td>US</td>
<td>Alpha-2 country code where the device is</td>
</tr>
<tr>
<td><strong>location.country</strong><br/><em>string</em></td>
<td>United States</td>
<td>Country name generated from <code class="prettyprint">country_code</code></td>
</tr>
<tr>
<td><strong>sensors</strong><br/><em>array</em></td>
<td>[<a href="#sensors">sensor</a>, <a href="#sensors">sensor</a>]</td>
<td>An array of sensor objects, with the <code class="prettyprint">value</code> (final calibrated reading) and <code class="prettyprint">raw_value</code> (uncalibrated reading) injected into them.</td>
</tr>
</tbody></table>

<h2 id="get-all-devices">Get All Devices</h2>

<blockquote>
<h3 id="definition">Definition</h3>

<p>GET https://new-api.smartcitizen.me/v0/devices</p>
</blockquote>
<pre><code class="highlight plaintext">$ curl -G https://new-api.smartcitizen.me/v0/devices
</code></pre>

<p>Returns all devices, with the same data as <a href="#get-a-device">above</a>.</p>

<table><thead>
<tr>
<th>Parameter</th>
<th>Example</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td><strong>near</strong><br/><em>string<br/>(lat,lng)</em></td>
<td>41.401108,<br/>2.215319</td>
<td>When included, returns devices in order of distance from the coordinates</td>
</tr>
</tbody></table>

<h2 id="remove-a-device">Remove a Device</h2>

<blockquote>
<h3 id="definition">Definition</h3>

<p><code class="prettyprint">DELETE https://new-api.smartcitizen.me/v0/devices/102</code></p>
</blockquote>

<p>You can only delete devices that you own.</p>

<h1 id="sensors">Sensors</h1>

<aside class='warning'>Sensors are currently READ-ONLY as they are an administration concern. This will change.</aside>

<aside class='notice'>Every device belongs to a kit. And every kit has many sensors. So every device has one kit, which has many sensors.</aside>

<p>Every <a href="#devices">device</a> has <code class="prettyprint">sensor(s)</code>. A <code class="prettyprint">sensor</code> is something on a <code class="prettyprint">device</code> that can record data. This could be anything, some examples are - temperature, humidity, battery percentage, # wifi networks.</p>

<h2 id=" get-all-sensors"> Get all Sensors</h2>

<blockquote>
<h3 id="definition">Definition</h3>

<p><code class="prettyprint">GET https://new-api.smartcitizen.me/v0/sensors</code></p>
</blockquote>
<pre><code class="highlight shell"><span class="gp">$ </span>curl -G https://new-api.smartcitizen.me/v0/sensors
<span class="o">[</span>
  <span class="o">{</span>
    <span class="s2">"id"</span> : 3,
    <span class="s2">"parent_id"</span> : null,
    <span class="s2">"name"</span> : <span class="s2">"DHT22"</span>,
    <span class="s2">"description"</span> : <span class="s2">"Digital Temperature and Relative Humidity Sensor"</span>,
    <span class="s2">"unit"</span> : null,
    <span class="s2">"created_at"</span> : <span class="s2">"2015-02-02T18:14:15.199Z"</span>,
    <span class="s2">"updated_at"</span> : <span class="s2">"2015-02-02T18:14:15.199Z"</span>
  <span class="o">}</span>,
  <span class="o">{</span>
    <span class="s2">"id"</span> : 4,
    <span class="s2">"parent_id"</span> : 3,
    <span class="s2">"name"</span> : <span class="s2">"DHT22 - Temperature"</span>,
    <span class="s2">"description"</span> : <span class="s2">"Temperature"</span>,
    <span class="s2">"unit"</span> : <span class="s2">"ºC"</span>,
    <span class="s2">"created_at"</span> : <span class="s2">"2015-02-02T18:15:14.132Z"</span>,
    <span class="s2">"updated_at"</span> : <span class="s2">"2015-02-02T18:15:14.132Z"</span>
  <span class="o">}</span>,
  <span class="o">{</span>
    <span class="s2">"id"</span> : 5,
    <span class="s2">"parent_id"</span> : 3,
    <span class="s2">"name"</span> : <span class="s2">"DHT22 - Humidity"</span>,
    <span class="s2">"description"</span> : <span class="s2">"Humidity"</span>,
    <span class="s2">"unit"</span> : <span class="s2">"%"</span>,
    <span class="s2">"created_at"</span> : <span class="s2">"2015-02-02T18:15:34.891Z"</span>,
    <span class="s2">"updated_at"</span> : <span class="s2">"2015-02-02T18:15:34.891Z"</span>
  <span class="o">}</span>
...
</code></pre>

<p>Sensors can contain multiple sub-sensors, such as the DHT-22, which records temperature and humidity. In the CURL example <code class="prettyprint">Sensor(id=3)</code> will not record any data, it is only in the database for organisational reasons.</p>

<h1 id="readings">Readings</h1>

<aside class='notice'>Every device has readings. A reading is a value recorded by one of its sensors.</aside>

<h2 id="get-latest-readings">Get Latest Readings</h2>

<blockquote>
<h3 id="definition">Definition</h3>

<p><code class="prettyprint">GET https://new-api.smartcitizen.me/v0/devices/:id</code></p>
</blockquote>

<p><strong>(for a device)</strong></p>

<p>The latest set of readings is included with the device, so if you call <code class="prettyprint">/v0/devices/:id</code> you will see the most recent set of readings embedded in <code class="prettyprint">data.sensors</code> as <code class="prettyprint">value</code> and <code class="prettyprint">raw_value</code>.</p>

<h2 id="get-historical-readings">Get Historical Readings</h2>

<blockquote>
<h3 id="definition">Definition</h3>

<p><code class="prettyprint">GET https://new-api.smartcitizen.me/v0/devices/:id/readings</code></p>
</blockquote>

<h1 id="kits">Kits</h1>

<p>At the moment, every <a href="#devices">device</a> has one <a href="#kits">kit</a>. In the future this will change, as some devices might not be associated with a <a href="#kits">kit</a>. However, you can assume that every device is associated with a kit right now.</p>

<h2 id="get-all-kits">Get All Kits</h2>

<blockquote>
<h3 id="definition">Definition</h3>

<p><code class="prettyprint">GET https://new-api.smartcitizen.me/v0/kits</code></p>
</blockquote>

<aside class='notice'>There are currently 2 variations of kit, the SCK 1.0 and SCK 1.1.</aside>

<p>More information about the current kits can be found on <a href="https://github.com/fablabbcn/Smart-Citizen-Kit/blob/master/hardware/README.md">github</a></p>

<h1 id="users">Users</h1>

<h2 id="add-a-user">Add a User</h2>

<blockquote>
<h3 id="definition">Definition</h3>

<p><code class="prettyprint">POST https://new-api.smartcitizen.me/v0/users</code></p>
</blockquote>

<p>Most actions on the API require authenticated access. To obtain an <a href="#oauth-2.0">OAuth 2.0</a> <code class="prettyprint">access_token</code> the first step is to have a user account.</p>

<table><thead>
<tr>
<th>Parameter</th>
<th>Required?</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td><strong>first_name</strong><br/><em>string</em></td>
<td></td>
<td>First name of the user</td>
</tr>
<tr>
<td><strong>last_name</strong><br/><em>string</em></td>
<td></td>
<td>Last name of the user</td>
</tr>
<tr>
<td><strong>email</strong><br/><em>string</em></td>
<td>✓</td>
<td>Email address of the user</td>
</tr>
<tr>
<td><strong>username</strong><br/><em>string</em></td>
<td>✓</td>
<td>Username of the user</td>
</tr>
<tr>
<td><strong>password</strong><br/><em>string</em></td>
<td>✓</td>
<td>Password of the user</td>
</tr>
<tr>
<td><strong>city</strong><br/><em>string</em></td>
<td></td>
<td>City where the user is located</td>
</tr>
<tr>
<td><strong>country_code</strong><br/><em>string</em></td>
<td></td>
<td><a href="https://en.wikipedia.org/wiki/ISO_3166-1_alpha-2">2 letter</a> country-code of the user</td>
</tr>
<tr>
<td><strong>url</strong><br/><em>string</em></td>
<td></td>
<td>Webpage of the user</td>
</tr>
<tr>
<td><strong>avatar</strong><br/><em>string</em></td>
<td></td>
<td>URL to the avatar of the user</td>
</tr>
</tbody></table>

<h2 id="get-current-user">Get Current User</h2>

<blockquote>
<h3 id="definition">Definition</h3>

<p><code class="prettyprint">GET https://new-api.smartcitizen.me/v0/me</code></p>

<h3 id="example-request">Example Request</h3>
</blockquote>
<pre><code class="highlight shell"><span class="gp">$ </span>curl -G https://new-api.smartcitizen.me/v0/me <span class="se">\</span>
    -H <span class="s2">"Authorization: Bearer 94abeabdec09f6670863766f792ead24d61fe3f9"</span>
</code></pre>

<p>Used to retrieve information about the currently authenticated user.
Returns a detailed representation of the user.</p>

<table><thead>
<tr>
<th>Parameter</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td><strong>id</strong><br/><em>integer</em></td>
<td>Unique ID for the user</td>
</tr>
<tr>
<td><strong>first_name</strong><br/><em>string</em></td>
<td>First name of the user</td>
</tr>
<tr>
<td><strong>last_name</strong><br/><em>string</em></td>
<td>Last name of the user</td>
</tr>
<tr>
<td><strong>email</strong><br/><em>string</em></td>
<td>Email address of the user</td>
</tr>
<tr>
<td><strong>username</strong><br/><em>string</em></td>
<td>Username of the user</td>
</tr>
<tr>
<td><strong>location.city</strong><br/><em>string</em></td>
<td>City where the user is located</td>
</tr>
<tr>
<td><strong>location.country_code</strong><br/><em>string</em></td>
<td><a href="https://en.wikipedia.org/wiki/ISO_3166-1_alpha-2">2 letter</a> country-code of the user</td>
</tr>
<tr>
<td><strong>location.country</strong><br/><em>string</em></td>
<td>Automatically generated from country_code</td>
</tr>
<tr>
<td><strong>url</strong><br/><em>string</em></td>
<td>Webpage of the user</td>
</tr>
<tr>
<td><strong>avatar</strong><br/><em>string</em></td>
<td>URL to the avatar of the user</td>
</tr>
<tr>
<td><strong>joined_at</strong><br/><em>datetime</em></td>
<td>The date and time that the user joined the platform</td>
</tr>
<tr>
<td><strong>devices</strong><br/><em>array</em></td>
<td>Array of <a href="#devices">devices</a> that the user manages on the platform</td>
</tr>
</tbody></table>

<h2 id="update-current-user">Update Current User</h2>

<blockquote>
<h3 id="definition">Definition</h3>

<p><code class="prettyprint">PATCH https://new-api.smartcitizen.me/v0/me</code></p>

<h3 id="example-request">Example Request</h3>
</blockquote>
<pre><code class="highlight shell"><span class="gp">$ </span>curl -G https://new-api.smartcitizen.me/v0/me <span class="se">\</span>
    -H <span class="s2">"Authorization: Bearer 94abeabdec09f6670863766f792ead24d61fe3f9"</span>
</code></pre>

<p>An authenticated user can update their own details. Same parameters used as <a href="#add-a-user">adding a user</a></p>

<h2 id="get-all-users">Get All Users</h2>

<blockquote>
<h3 id=" definition"> Definition</h3>

<p>GET https://new-api.smartcitizen.me/v0/users</p>
</blockquote>
<pre><code class="highlight shell">curl <span class="s2">"https://new-api.smartcitizen.me/v0/users"</span>
  -H <span class="s2">"Authorization: Bearer 94abeabdec09f6670863766f792ead24d61fe3f9"</span>
</code></pre>

<p>This endpoint retrieves all users.</p>

<h3 id="http-request">HTTP Request</h3>

<p><code class="prettyprint">GET https://new-api.smartcitizen.me/v0/users</code></p>

<h2 id="get-a-user">Get a User</h2>
<pre><code class="highlight shell">curl <span class="s2">"https://new-api.smartcitizen.me/v0/users/3"</span>
  -H <span class="s2">"Authorization: Bearer 94abeabdec09f6670863766f792ead24d61fe3f9"</span>
</code></pre>

<blockquote>
<p>The above command returns JSON structured like this:</p>
</blockquote>
<pre><code class="highlight json"><span class="p">{</span><span class="w">
  </span><span class="s2">"id"</span><span class="p">:</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w">
  </span><span class="s2">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Isis"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"breed"</span><span class="p">:</span><span class="w"> </span><span class="s2">"unknown"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"fluffiness"</span><span class="p">:</span><span class="w"> </span><span class="mi">5</span><span class="p">,</span><span class="w">
  </span><span class="s2">"cuteness"</span><span class="p">:</span><span class="w"> </span><span class="mi">10</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>

<p>This endpoint retrieves a specific user.</p>

<h3 id="http-request">HTTP Request</h3>

<p><code class="prettyprint">GET https://new-api.smartcitizen.me/v0/users/&lt;ID|username&gt;</code></p>

<h3 id="url-parameters">URL Parameters</h3>

<table><thead>
<tr>
<th>Parameter</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>ID or username</td>
<td>The ID or username of the user to retrieve</td>
</tr>
</tbody></table>

          <h1 id="response-status-codes">Response Status Codes</h1>

<h2 id="error-messages">Error Messages</h2>
<pre><code class="highlight shell">HTTP/1.1 404 Not Found
<span class="o">{</span>
  <span class="s2">"id"</span> : <span class="s2">"record_not_found"</span>,
  <span class="s2">"message"</span> : <span class="s2">"Couldn't find Device with 'id'=101308"</span>,
  <span class="s2">"url"</span> : null
<span class="o">}</span>


HTTP/1.1 422 Unprocessable Entity
<span class="o">{</span>
  <span class="s2">"id"</span>: <span class="s2">"unprocessable_entity"</span>,
  <span class="s2">"message"</span>: <span class="s2">"Unprocessable Entity"</span>,
  <span class="s2">"errors"</span>: <span class="o">{</span>
    <span class="s2">"mac_address"</span>: <span class="o">[</span>
      <span class="s2">"can't be blank"</span>,
      <span class="s2">"is invalid"</span>
    <span class="o">]</span>,
    <span class="s2">"name"</span>: <span class="o">[</span>
      <span class="s2">"can't be blank"</span>
    <span class="o">]</span>
  <span class="o">}</span>,
  <span class="s2">"url"</span>: null
<span class="o">}</span>
</code></pre>

<aside class="notice">message and url will probably change, but it is unlikely that the status code will</aside>

<p>When possible, read the HTTP status codes to learn of the success of your request. The API uses the following pattern for error messages, as recommended by <a href="https://github.com/interagent/http-api-design">https://github.com/interagent/http-api-design</a>.</p>

<h2 id="success-codes">Success Codes</h2>

<table><thead>
<tr>
<th>Code</th>
<th>Meaning</th>
</tr>
</thead><tbody>
<tr>
<td>200</td>
<td>Request succeeded for a GET call, for a DELETE or PATCH call that completed synchronously, or for a PATCH call that synchronously updated an existing resource</td>
</tr>
<tr>
<td>201</td>
<td>Request succeeded for a POST call that completed synchronously, or for a PATCH call that synchronously created a new resource</td>
</tr>
</tbody></table>

<h2 id="error-codes">Error Codes</h2>

<table><thead>
<tr>
<th>Code</th>
<th>Meaning</th>
</tr>
</thead><tbody>
<tr>
<td>400</td>
<td>Bad Request &ndash; there is a problem with your request</td>
</tr>
<tr>
<td>401</td>
<td>Unauthorized &ndash; Your <a href="#authentication">authentication credentials</a> are incorrect</td>
</tr>
<tr>
<td>403</td>
<td>Forbidden &ndash; The resource requested is hidden, or you do not have the necessary privileges</td>
</tr>
<tr>
<td>404</td>
<td>Not Found &ndash; The specified resource could not be found</td>
</tr>
<tr>
<td>405</td>
<td>Method Not Allowed &ndash; You tried to access a resource with an invalid method</td>
</tr>
<tr>
<td>406</td>
<td>Not Acceptable &ndash; You requested a format that isn&rsquo;t json</td>
</tr>
<tr>
<td>422</td>
<td>Unprocessable Entity: Your request was understood, but contained invalid parameters</td>
</tr>
<tr>
<td>429</td>
<td>Too Many Requests</td>
</tr>
<tr>
<td>500</td>
<td>Internal Server Error</td>
</tr>
<tr>
<td>503</td>
<td>Service Unavailable &ndash; We&rsquo;re temporarially offline for maintanance. Please try again later</td>
</tr>
</tbody></table>

      </div>
      <div class="dark-box">
      </div>
    </div>
  </body>
</html>
